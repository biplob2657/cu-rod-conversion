<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover"/>
  <title>RR Cable Shop</title>
  <style>
    :root{ --bg:#ffffff; --panel:#ffffff; --ink:#111111; --muted:#5b5f6a; --line:#e6e8ec; --btn:#111; --btn-ink:#fff; --red:#e10600 }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--ink);font:15px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif}

    /* ===== Shell (sidebar + content) ===== */
    .layout{max-width:1200px;margin:0 auto;display:flex;gap:14px;padding:10px}
    .sidebar{width:240px;background:#fff;border:1px solid var(--line);border-radius:16px;padding:14px;box-shadow:0 10px 24px rgba(0,0,0,.06);position:sticky;top:10px;height:fit-content}
    .brand{font-weight:900;font-size:18px;letter-spacing:.2px;margin-bottom:12px;display:flex;align-items:center;gap:8px}
    .brand .badge{background:var(--red);color:#fff;padding:6px 10px;border-radius:10px}
    .nav{display:flex;flex-direction:column;gap:8px}
    .nav button{appearance:none;border:1px solid var(--line);background:#fff;color:#111;text-align:left;padding:10px 12px;border-radius:10px;font-weight:800;cursor:pointer}
    .nav button.active{background:var(--red);border-color:var(--red);color:#fff}

    .content{flex:1}
    .hdr{text-align:center;margin-bottom:10px}
    .title3d{margin:0;font-size:24px;letter-spacing:.2px;line-height:1.1;color:#111;position:relative;text-shadow:0 1px 0 #fff,0 2px 0 #eee,0 3px 0 #e6e6e6,0 4px 0 #ddd,0 8px 12px rgba(0,0,0,.12)}
    .title3d:after{content:"";display:block;width:120px;height:3px;background:var(--red);margin:8px auto 0;border-radius:2px}
    .powered{margin-top:6px;color:var(--muted);font-size:12px}

    /* Pages */
    .page{display:none}
    .page.active{display:block}

    /* Calendar */
    .cal{background:#fff;border:1px solid var(--line);border-radius:16px;padding:12px;box-shadow:0 10px 24px rgba(0,0,0,.06)}
    .cal-head{display:flex;align-items:center;justify-content:space-between;gap:8px;flex-wrap:wrap}
    .cal-title{display:flex;align-items:center;gap:8px;font-weight:900}
    .cal-head .btn-icon{width:38px;height:38px;border-radius:10px;border:1px solid var(--line);background:#fff;cursor:pointer;font-size:18px}
    .cal-when{display:flex;gap:8px}
    .cal-when select,.cal-when input{padding:8px 10px;border-radius:10px;border:1px solid var(--line)}
    .cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:6px;margin-top:10px}
    .cal-grid .cell{aspect-ratio:1/1;border:1px solid var(--line);border-radius:10px;display:flex;align-items:center;justify-content:center}
    .cal-grid .dow{font-weight:800;background:#fafbfc}
    .cal-grid .muted{color:#999}
    .cal-grid .today{border-color:var(--red);box-shadow:0 0 0 2px var(--red) inset;font-weight:800}

    /* Brain Game */
    .game{background:#fff;border:1px solid var(--line);border-radius:16px;padding:12px;box-shadow:0 10px 24px rgba(0,0,0,.06);margin-top:12px}
    .game-row{display:grid;grid-template-columns:1fr;gap:10px}
    .game h3{margin:0 0 6px 0}
    .q{font-size:22px;font-weight:900;letter-spacing:.5px}
    .stat{display:flex;flex-wrap:wrap;gap:8px;margin-top:6px}
    .pill{border:1px solid var(--line);border-radius:10px;padding:8px 10px;background:#fff}
    .ok{color:#0a7f3f}.err{color:#a11212}
    .game .row{display:grid;grid-template-columns:1fr auto auto;gap:8px;align-items:end}
    .hint{font-size:12px;color:var(--muted);margin-top:4px}

    /* Mobile nav: off-canvas */
    .topbar{display:none}
    @media (max-width:900px){
      .layout{flex-direction:column;padding:0}
      .topbar{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:10px 12px;border-bottom:1px solid var(--line);position:sticky;top:0;background:#fff;z-index:20}
      .menu-btn{border:1px solid var(--line);background:#fff;padding:8px 10px;border-radius:10px;font-weight:800}
      .sidebar{position:fixed;left:0;top:0;bottom:0;transform:translateX(-100%);transition:transform .25s ease;width:min(78%,320px);z-index:30}
      body.menu-open .sidebar{transform:translateX(0)}
    }

    /* Buttons, inputs */
    .btn{background:var(--btn);color:var(--btn-ink);border:1px solid #000;cursor:pointer;font-weight:800;letter-spacing:.2px;padding:10px 12px;border-radius:10px}
    .btn-ghost{background:#fff;color:#111;border:1px solid var(--line);font-weight:700}
    input,button,select{font-size:16px}
    input[type=number], input[type=text]{width:100%;padding:12px;border:1px solid var(--line);border-radius:10px;background:#fff;color:#111}

    /* Existing cards / controls for calculators */
    .card{background:var(--panel);border:1px solid var(--line);border-radius:14px;padding:12px;box-shadow:0 10px 24px rgba(0,0,0,.06)}
    .grid{display:grid;grid-template-columns:1fr;gap:10px}
    @media (min-width:560px){.grid{grid-template-columns:1fr 1fr}}

    .row{display:grid;grid-template-columns:1fr auto auto;gap:10px;align-items:end;margin-top:10px}
    .result{margin-top:12px;border-top:1px dashed var(--line);padding-top:10px}
    .caps{display:grid;grid-template-columns:1fr 1fr;gap:8px}
    @media (max-width:480px){.caps{grid-template-columns:1fr}}
    .mono{font-variant-numeric:tabular-nums}
    .tbl{width:100%;border-collapse:collapse;margin-top:10px}
    .tbl th,.tbl td{border-bottom:1px dashed var(--line);padding:10px 6px;text-align:left}
    .note{color:var(--muted);font-size:12px;margin-top:6px}
    .seg{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:8px}
    .seg button{padding:10px;border-radius:10px;border:1px solid var(--line);background:#fff;font-weight:700}
    .seg button.active{background:#111;color:#fff;border-color:#111}
    .svg-wrap{width:100%;overflow:auto}

    /* PIN gate */
    #gate{position:fixed;inset:0;background:#fff;display:flex;align-items:center;justify-content:center;z-index:9999}
    .gate-card{width:min(420px,92%);background:#fff;border:1px solid var(--line);border-radius:16px;padding:18px;box-shadow:0 10px 24px rgba(0,0,0,.08)}
    .gate-title{margin:0 0 10px;font-size:20px;text-align:center}
    .gate-sub{margin:0 0 14px;color:var(--muted);font-size:13px;text-align:center}
    .fade{animation:fadeout .6s ease forwards}
    @keyframes fadeout{to{opacity:0;transform:scale(.98)}}
    .gate-row{display:grid;grid-template-columns:1fr auto;gap:8px}
    .gate-row input{font-size:18px;letter-spacing:2px}
    .gate-err{color:#a11212;font-size:12px;height:16px;margin-top:6px;text-align:center}
    .shake{animation:shake .2s linear 2}
    @keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-6px)}75%{transform:translateX(6px)}}

    /* 3D Motion accents */
    .lift{transform-style:preserve-3d;will-change:transform,box-shadow;animation:floaty 8s ease-in-out infinite}
    @keyframes floaty{0%,100%{transform:translateY(0)}50%{transform:translateY(-4px)}}
    .month-anim{animation:monthFlip .5s cubic-bezier(.2,.8,.2,1)}
    @keyframes monthFlip{0%{transform:rotateX(-12deg) translateY(-6px);opacity:0}100%{transform:none;opacity:1}}

    /* Copper Conversion scoped */
    .cu .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:10px}
    .cu .col-12{grid-column:span 12}
    .cu .col-6{grid-column:span 6}
    @media (max-width:760px){.cu .grid{grid-template-columns:repeat(6,1fr)}.cu .col-6{grid-column:span 6}}
    .cu label{display:block;font-size:13px;color:var(--muted);margin:0 0 6px 2px}
    .cu select,.cu input{width:100%;padding:12px;border-radius:10px;border:1px solid var(--line);background:#fff;color:#111}
    .cu .seg{display:flex;border:1px solid var(--line);padding:6px;border-radius:10px;background:#fff}
    .cu .seg button{flex:1;border:0;background:transparent;color:#666;padding:10px 12px;border-radius:8px;font-weight:700}
    .cu .seg button.active{background:#111;color:#fff}
  </style>
</head>
<body>
  <!-- PIN Gate Overlay -->
  <div id="gate" role="dialog" aria-modal="true">
    <div class="gate-card">
      <h2 class="gate-title">Enter PIN</h2>
      <p class="gate-sub">Protected by RR Operations Team</p>
      <div class="gate-row">
        <input id="pin" type="password" inputmode="numeric" pattern="[0-9]*" maxlength="6" placeholder="••••" aria-label="PIN" />
        <button class="btn" id="unlockBtn">Unlock</button>
      </div>
      <div class="gate-err" id="gateErr"></div>
    </div>
  </div>

  <div class="layout">
    <div class="topbar">
      <button class="menu-btn" id="menuBtn" aria-label="Menu">☰</button>
      <div class="brand"><span class="badge">RR</span><span>Cable Shop</span></div>
      <div style="width:40px"></div>
    </div>

    <aside class="sidebar" id="sidebar">
      <div class="brand"><span class="badge">RR</span><span>Cable Shop</span></div>
      <nav class="nav">
        <button class="active" data-target="home">Home</button>
        <button data-target="selector">Reel Selector</button>
        <button data-target="dimension">Reel Dimension</button>
        <button data-target="standard">Standard Wood Reel</button>
        <button data-target="copper">Copper Conversion</button>
      </nav>
    </aside>

    <main class="content">
      <div class="app">
        <div class="hdr">
          <h1 class="title3d">RR Cable Shop</h1>
          <div class="powered">Powered by <b>RR Operations Team</b></div>
        </div>

        <!-- Home (Calendar + Brain Game) -->
        <section id="home" class="page active">
          <div class="cal card lift" id="calCard">
            <div class="cal-head">
              <button class="btn-icon" id="calPrev" aria-label="Previous Month">‹</button>
              <div class="cal-title">
                <div id="calLabel">—</div>
                <div class="cal-when">
                  <select id="calMonth" aria-label="Month"></select>
                  <input id="calYear" type="number" min="1900" max="2100" aria-label="Year"/>
                </div>
              </div>
              <button class="btn-icon" id="calNext" aria-label="Next Month">›</button>
              <button class="btn btn-ghost" id="calToday" aria-label="Jump to Today">Today</button>
            </div>
            <div class="cal-grid" id="calGrid"></div>
          </div>

          <div class="game lift" id="gameCard">
            <h3>Brain Game — Quick Math</h3>
            <div class="game-row">
              <div class="q" id="qText">Press Start</div>
              <div class="row">
                <input id="ans" type="number" inputmode="numeric" placeholder="Your answer" disabled />
                <button class="btn" id="submitAns" disabled>Submit</button>
                <button class="btn-ghost" id="nextQ" disabled>Next</button>
              </div>
              <div class="row" style="grid-template-columns:1fr auto auto;">
                <div class="pill">Time: <b id="gTime">—</b></div>
                <button class="btn" id="start60">Start 60s</button>
                <button class="btn-ghost" id="stopGame" disabled>Stop</button>
              </div>
              <div class="stat">
                <div class="pill">Score: <b id="gScore">0</b></div>
                <div class="pill">Correct: <b id="gRight">0</b></div>
                <div class="pill">Wrong: <b id="gWrong">0</b></div>
                <div class="pill">Streak: <b id="gStreak">0</b></div>
                <div class="pill">Accuracy: <b id="gAcc">0%</b></div>
              </div>
              <div class="hint" id="gHint">Normal level: +, −, × with 1–2 digit numbers. Tip: use Enter to submit.</div>
              <div class="hint" id="gMsg"></div>
            </div>
          </div>
        </section>

        <!-- 01. Reel Selector -->
        <section id="selector" class="page">
          <details class="acd" open>
            <summary>01. Reel Selector</summary>
            <div class="acd-body">
              <div class="seg">
                <button id="mode-regular" class="active" onclick="setMode('regular')">Regular</button>
                <button id="mode-custom" onclick="setMode('custom')">Customized</button>
              </div>

              <!-- Regular -->
              <div id="panel-regular" class="card">
                <div class="grid">
                  <div>
                    <label>Cable OD (mm)</label>
                    <input id="r-cable-od" type="number" min="1" step="0.1" placeholder="e.g., 31">
                  </div>
                  <div>
                    <label>Length (m)</label>
                    <input id="r-length" type="number" min="1" step="1" placeholder="e.g., 1050">
                  </div>
                </div>
                <div class="row">
                  <button class="btn" onclick="computeRegular()">Calculate</button>
                  <button class="btn-ghost" onclick="resetRegular()">Reset</button>
                  <button class="btn-ghost" onclick="copyRegular()" id="r-copy">Copy</button>
                </div>
                <div id="r-out" class="result"></div>
              </div>

              <!-- Customized -->
              <div id="panel-custom" class="card" style="display:none">
                <div class="grid">
                  <div>
                    <label>Cable OD (mm)</label>
                    <input id="c-cable-od" type="number" min="1" step="0.1" placeholder="e.g., 31">
                  </div>
                  <div>
                    <label>Reel OD (mm)</label>
                    <input id="c-rod" type="number" min="100" step="1" placeholder="e.g., 1600">
                  </div>
                  <div>
                    <label>Barrel ID (mm)</label>
                    <input id="c-rid" type="number" min="50" step="1" placeholder="e.g., 800">
                  </div>
                  <div>
                    <label>Traverse (mm)</label>
                    <input id="c-trv" type="number" min="50" step="1" placeholder="e.g., 800">
                  </div>
                </div>
                <div class="row">
                  <button class="btn" onclick="computeCustom()">Calculate</button>
                  <button class="btn-ghost" onclick="resetCustom()">Reset</button>
                  <button class="btn-ghost" onclick="copyCustom()" id="c-copy">Copy</button>
                </div>
                <div id="c-out" class="result"></div>
              </div>
            </div>
          </details>
        </section>

        <!-- 02. Reel Dimension -->
        <section id="dimension" class="page">
          <details class="acd" open>
            <summary>02. Reel Dimension</summary>
            <div class="acd-body">
              <div class="card">
                <div class="svg-wrap">
                  <svg viewBox="0 0 900 320" width="100%" height="auto" xmlns="http://www.w3.org/2000/svg" aria-label="Wooden reel dimension diagram">
                    <defs><marker id="arrow" markerWidth="8" markerHeight="8" refX="6" refY="4" orient="auto" markerUnits="strokeWidth"><path d="M0,0 L8,4 L0,8 Z" fill="#111"/></marker></defs>
                    <g font-family="system-ui, -apple-system, Segoe UI, Roboto, sans-serif" font-size="14" fill="#111" stroke="#111" stroke-width="2">
                      <g transform="translate(150,160)">
                        <circle cx="0" cy="0" r="110" fill="none" stroke="#111"/>
                        <circle cx="0" cy="0" r="55" fill="none" stroke="#111"/>
                        <line x1="-140" y1="-110" x2="-140" y2="110" marker-start="url(#arrow)" marker-end="url(#arrow)"/>
                        <text x="-180" y="0" transform="rotate(-90 -180,0)" text-anchor="middle">OD — Flange Diameter</text>
                        <line x1="140" y1="-55" x2="140" y2="55" marker-start="url(#arrow)" marker-end="url(#arrow)"/>
                        <text x="170" y="0" transform="rotate(-90 170,0)" text-anchor="middle">Barrel ID — Core/Drum</text>
                        <text x="0" y="140" text-anchor="middle" font-weight="700">Front View</text>
                      </g>
                      <g transform="translate(540,60)">
                        <rect x="0" y="0" width="22" height="200" fill="#fff"/>
                        <rect x="22" y="40" width="156" height="120" fill="#fff"/>
                        <rect x="178" y="0" width="22" height="200" fill="#fff"/>
                        <line x1="22" y1="230" x2="178" y2="230" marker-start="url(#arrow)" marker-end="url(#arrow)"/>
                        <text x="100" y="252" text-anchor="middle">Traverse — Between Flanges</text>
                        <text x="100" y="-12" text-anchor="middle" font-weight="700">Side View</text>
                      </g>
                      <g transform="translate(30,300)" font-size="12">
                        <text>• <tspan font-weight="700">OD</tspan> = Flange outer diameter (mm)</text>
                        <text x="250">• <tspan font-weight="700">Barrel ID</tspan> = Core/Drum diameter (mm)</text>
                        <text x="530">• <tspan font-weight="700">Traverse</tspan> = Distance between flanges (mm)</text>
                      </g>
                    </g>
                  </svg>
                </div>
              </div>
            </div>
          </details>
        </section>

        <!-- 03. Standard Wood Reel -->
        <section id="standard" class="page">
          <details class="acd" open>
            <summary>03. Standard Wood Reel</summary>
            <div class="acd-body">
              <div class="card">
                <div class="grid">
                  <div>
                    <label>Cable OD (mm)</label>
                    <input id="t-od" type="number" min="1" step="0.1" placeholder="e.g., 31" value="31">
                  </div>
                  <div>
                    <label>Length (m) <span style="color:var(--muted)">(optional)</span></label>
                    <input id="t-len" type="number" min="1" step="1" placeholder="e.g., 1050">
                  </div>
                </div>
                <div class="row">
                  <button class="btn" onclick="buildReelTable()">Update</button>
                </div>
                <table class="tbl mono" id="reel-table"></table>
                <div class="note">Capacities use your factory calibration (PF = 0.7855) at 90% fill. Geometric @90% is higher and shown only in the selector for reference.</div>
              </div>
            </div>
          </details>
        </section>

        <!-- 04. Copper Rod Conversion -->
        <section id="copper" class="page">
          <details class="acd" open>
            <summary>04. Copper Rod Conversion</summary>
            <div class="acd-body">
              <div class="cu">
                <section class="card panel" aria-label="Inputs">
                  <div class="grid">
                    <div class="col-12">
                      <label for="cu-type">Select Type</label>
                      <div class="seg" role="tablist" aria-label="Product Type">
                        <button id="cu-tStrip" class="active" role="tab" aria-selected="true">Strip</button>
                        <button id="cu-tRod" role="tab" aria-selected="false">Bare Rod / Wire</button>
                        <button id="cu-tRM" role="tab" aria-selected="false">Bare Cable (RM)</button>
                      </div>
                    </div>
                    <div class="col-12">
                      <label for="cu-mode">Select Conversion</label>
                      <select id="cu-mode" aria-label="Conversion Mode">
                        <option>Kg to Meter</option>
                        <option>Kg to Ft</option>
                        <option>Meter to Kg</option>
                        <option>Ft to Kg</option>
                      </select>
                    </div>
                    <div class="col-6 only-strip">
                      <label for="cu-width">Given Width (mm)</label>
                      <input id="cu-width" type="number" inputmode="decimal" min="0" step="any" placeholder="e.g., 10" />
                    </div>
                    <div class="col-6 only-strip">
                      <label for="cu-thickness">Given Thickness (mm)</label>
                      <input id="cu-thickness" type="number" inputmode="decimal" min="0" step="any" placeholder="e.g., 3" />
                    </div>
                    <div class="col-6 only-rod" style="display:none">
                      <label for="cu-diameter">Given Diameter (mm)</label>
                      <input id="cu-diameter" type="number" inputmode="decimal" min="0" step="any" placeholder="e.g., 12" />
                    </div>
                    <div class="col-6 only-rm" style="display:none">
                      <label for="cu-areaRM">Cable (RM) Size (mm²)</label>
                      <input id="cu-areaRM" type="number" inputmode="decimal" min="0" step="any" placeholder="e.g., 1.3" />
                    </div>
                    <div class="col-12">
                      <label id="cu-given-label" for="cu-given">Given Kg</label>
                      <input id="cu-given" type="number" inputmode="decimal" min="0" step="any" placeholder="e.g., 500" />
                    </div>
                    <div class="col-12" style="display:flex;gap:10px;flex-wrap:wrap">
                      <button id="cu-reset" class="btn-ghost btn" type="button">Reset</button>
                      <button id="cu-copy" class="btn" type="button" title="Copy result">Copy Result</button>
                      <button id="cu-quickSwap" class="btn-ghost btn" type="button" title="Swap Kg⇄Length where applicable">Swap</button>
                    </div>
                  </div>
                </section>

                <section class="card panel" style="margin-top:14px" aria-label="Details">
                  <div class="grid">
                    <div class="col-6">
                      <div class="pill">Area: <b id="cu-area">—</b> mm²</div>
                    </div>
                    <div class="col-6">
                      <div class="pill">Mass per meter: <b id="cu-kgpm">—</b> kg/m</div>
                    </div>
                  </div>
                  <div class="mono" id="cu-result-head" style="font-weight:800;margin-top:10px">Result: —</div>
                  <div class="note" id="cu-result-sub">Enter dimensions & a value to calculate.</div>
                </section>
              </div>
            </div>
          </details>
        </section>

      </div> <!-- /.app -->
    </main>
  </div> <!-- /.layout -->

  <script>
    /* ===== PIN logic ===== */
    const PIN_CODE = "1234"; // ← change this to your PIN
    const MAX_TRIES = 5;
    let tries = 0;
    function hideGate(){ const g=document.getElementById('gate'); if(g) g.style.display='none'; }
    function showGate(){ const g=document.getElementById('gate'); if(g) g.style.display='flex'; }
    function tryUnlock(){
      const inp = document.getElementById('pin');
      const err = document.getElementById('gateErr');
      const btn = document.getElementById('unlockBtn');
      const v = (inp.value||'').trim();
      if(v === PIN_CODE){
        err.textContent = '';
        sessionStorage.setItem('reel_unlocked','1');
        document.querySelector('.gate-card').classList.add('fade');
        setTimeout(()=>{ hideGate(); }, 550);
        return;
      }
      tries++;
      err.textContent = `Wrong PIN (${tries}/${MAX_TRIES})`;
      btn.classList.add('shake'); setTimeout(()=>btn.classList.remove('shake'),220);
      if(tries>=MAX_TRIES){ err.textContent = 'Locked — reload page to try again.'; btn.disabled=true; }
      inp.value=''; inp.focus();
    }
    document.getElementById('unlockBtn').addEventListener('click', tryUnlock);
    document.getElementById('pin').addEventListener('keydown', (e)=>{ if(e.key==='Enter') tryUnlock() });
    if(sessionStorage.getItem('reel_unlocked')==='1') hideGate(); else showGate();

    /* ===== Navigation (sidebar & pages) ===== */
    (function(){
      const buttons = document.querySelectorAll('.sidebar .nav button');
      const pages = ['home','selector','dimension','standard','copper'];
      function showPage(id){
        pages.forEach(p=>{ const sec=document.getElementById(p); if(sec) sec.classList.toggle('active', p===id); });
        buttons.forEach(b=> b.classList.toggle('active', b.dataset.target===id));
        const openDetails = document.querySelector('#'+id+' details.acd');
        if(openDetails) openDetails.setAttribute('open','');
        document.body.classList.remove('menu-open');
        window.scrollTo({top:0,behavior:'smooth'});
      }
      buttons.forEach(btn=> btn.addEventListener('click',()=> showPage(btn.dataset.target)));
      const menuBtn = document.getElementById('menuBtn');
      if(menuBtn){ menuBtn.addEventListener('click', ()=> document.body.classList.toggle('menu-open')); }
      showPage('home');
    })();

    /* ===== Mini Calendar ===== */
    (function(){
      const label = document.getElementById('calLabel');
      const grid  = document.getElementById('calGrid');
      const mSel  = document.getElementById('calMonth');
      const yInp  = document.getElementById('calYear');
      const prev  = document.getElementById('calPrev');
      const next  = document.getElementById('calNext');
      const todayBtn = document.getElementById('calToday');
      const card = document.getElementById('calCard');

      const MONTHS = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
      const DAYS   = ['S','M','T','W','T','F','S'];

      let current = new Date();

      function buildSelectors(){
        mSel.innerHTML = '';
        MONTHS.forEach((m,i)=>{ const opt=document.createElement('option'); opt.value=i; opt.textContent=m; mSel.appendChild(opt); });
      }
      function setSelectors(dt){ mSel.value = dt.getMonth(); yInp.value = dt.getFullYear(); }
      function animateFlip(){ if(!card) return; card.classList.remove('month-anim'); void card.offsetWidth; card.classList.add('month-anim'); setTimeout(()=>card.classList.remove('month-anim'),520); }

      function render(dt){
        const y = dt.getFullYear(), m = dt.getMonth();
        label.textContent = MONTHS[m] + ' ' + y;
        grid.innerHTML = '';
        DAYS.forEach(d=>{ const c=document.createElement('div'); c.textContent=d; c.className='cell dow'; grid.appendChild(c); });
        const first = new Date(y,m,1); const start = first.getDay();
        const daysInMonth = new Date(y,m+1,0).getDate();
        const today = new Date();
        for(let i=0;i<start;i++){ const c=document.createElement('div'); c.className='cell muted'; c.textContent=''; grid.appendChild(c); }
        for(let d=1; d<=daysInMonth; d++){
          const c=document.createElement('div'); c.className='cell'; c.textContent=d;
          if(today.getFullYear()===y && today.getMonth()===m && today.getDate()===d){ c.classList.add('today'); }
          grid.appendChild(c);
        }
      }
      function update(){ current = new Date(Number(yInp.value), Number(mSel.value), 1); render(current); animateFlip(); }
      prev.addEventListener('click', ()=>{ current.setMonth(current.getMonth()-1); setSelectors(current); render(current); animateFlip(); });
      next.addEventListener('click', ()=>{ current.setMonth(current.getMonth()+1); setSelectors(current); render(current); animateFlip(); });
      mSel.addEventListener('change', update);
      yInp.addEventListener('change', update);
      if(todayBtn){ todayBtn.addEventListener('click', ()=>{ current = new Date(); setSelectors(current); render(current); animateFlip(); }); }

      buildSelectors(); setSelectors(current); render(current);
    })();

    /* ===== Brain Game (Normal level) ===== */
    (function(){
      const qText = document.getElementById('qText');
      const ans   = document.getElementById('ans');
      const submit= document.getElementById('submitAns');
      const next  = document.getElementById('nextQ');
      const start = document.getElementById('start60');
      const stop  = document.getElementById('stopGame');
      const tEl   = document.getElementById('gTime');
      const sEl   = document.getElementById('gScore');
      const rEl   = document.getElementById('gRight');
      const wEl   = document.getElementById('gWrong');
      const stEl  = document.getElementById('gStreak');
      const aEl   = document.getElementById('gAcc');
      const msg   = document.getElementById('gMsg');

      let correct=0, wrong=0, score=0, streak=0, total=0;
      let currentAns = null;
      let timer = null, timeLeft = 0, running = false;

      function rnd(min,max){ return Math.floor(Math.random()*(max-min+1))+min; }

      function genQuestion(){
        // Normal level: +, −, × using 1–2 digit numbers, avoid negatives
        const ops = ['+','-','×'];
        const op = ops[rnd(0,ops.length-1)];
        let a = rnd(4,99), b = rnd(3,12);
        if(op==='+'){ b = rnd(4,99); currentAns = a + b; }
        else if(op==='-'){ if(b>a){ const t=a; a=b; b=t; } currentAns = a - b; }
        else { // ×
          a = rnd(4,12); b = rnd(3,12); currentAns = a * b;
        }
        qText.textContent = `${a} ${op} ${b} = ?`;
      }

      function updateStats(){
        total = correct + wrong;
        const acc = total? Math.round(correct*100/total) : 0;
        sEl.textContent = score;
        rEl.textContent = correct;
        wEl.textContent = wrong;
        stEl.textContent = streak;
        aEl.textContent = acc + '%';
      }

      function setGameUI(enabled){
        ans.disabled = !enabled;
        submit.disabled = !enabled;
        next.disabled = !enabled;
        if(enabled){ ans.focus(); }
      }

      function startPractice(){
        // practice mode (no timer)
        running = false; clearInterval(timer); tEl.textContent = '∞';
        setGameUI(true); start.disabled=false; stop.disabled=true;
        msg.textContent = 'Practice mode — unlimited time.'; msg.className='hint';
      }

      function start60s(){
        running = true; timeLeft = 60; tEl.textContent = timeLeft + 's';
        start.disabled=true; stop.disabled=false;
        setGameUI(true); tick();
        timer = setInterval(tick, 1000);
        msg.textContent = '60-second challenge started!'; msg.className='hint';
      }
      function stopNow(){
        running = false; clearInterval(timer); start.disabled=false; stop.disabled=true;
        tEl.textContent = '—'; msg.textContent = 'Stopped.'; msg.className='hint';
      }
      function tick(){
        if(!running) return;
        timeLeft--; tEl.textContent = timeLeft + 's';
        if(timeLeft<=0){ clearInterval(timer); running=false; setGameUI(false); start.disabled=false; stop.disabled=true;
          msg.textContent = `Time up! Score: ${score}, Accuracy: ${aEl.textContent}`; msg.className='hint';
        }
      }

      function submitAnswer(){
        const v = Number(ans.value);
        if(!Number.isFinite(v)){ msg.textContent='Enter a number.'; msg.className='hint err'; return; }
        if(v === currentAns){
          correct++; streak++; score += (running? 2 : 1) + Math.min(streak,5); // small streak bonus
          msg.textContent='Correct!'; msg.className='hint ok';
        }else{
          wrong++; streak=0; score = Math.max(0, score-1);
          msg.textContent=`Wrong. Ans = ${currentAns}`; msg.className='hint err';
        }
        updateStats();
        ans.value='';
        genQuestion();
      }

      function nextQuestion(){ msg.textContent=''; genQuestion(); ans.value=''; ans.focus(); }

      // wire
      submit.addEventListener('click', submitAnswer);
      next.addEventListener('click', nextQuestion);
      ans.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ submitAnswer(); } });
      start.addEventListener('click', start60s);
      stop.addEventListener('click', stopNow);

      // init
      correct=wrong=score=streak=0; updateStats(); setGameUI(false);
      genQuestion(); startPractice(); // default: practice ready
    })();
  </script>

  <script>
    /* ===== Reel capacity logic ===== */
    const FILL = 0.90;        // 90% target
    const PF_CAL = 0.7855;    // factory calibration factor

    const reels = [
      {reel:560,  od:560,  id:250, traverse:300},
      {reel:600,  od:600,  id:400, traverse:315},
      {reel:610,  od:610,  id:300, traverse:400},
      {reel:700,  od:700,  id:400, traverse:355},
      {reel:800,  od:800,  id:400, traverse:400},
      {reel:900,  od:900,  id:565, traverse:400},
      {reel:1000, od:1000, id:565, traverse:450},
      {reel:1100, od:1100, id:600, traverse:500},
      {reel:1200, od:1200, id:700, traverse:600},
      {reel:1400, od:1400, id:800, traverse:700},
      {reel:1600, od:1600, id:800, traverse:800},
      {reel:1800, od:1800, id:850, traverse:900},
      {reel:2000, od:2000, id:970, traverse:900}
    ];

    function cap90_geometric(rod,rid,trv,d){ return FILL * (trv*((rod*rod - rid*rid)/(d*d)))/1000 }
    function cap90_factory(rod,rid,trv,d){ return PF_CAL * cap90_geometric(rod,rid,trv,d) }
    function fmtMeters(x){ if(!isFinite(x)) return '—'; return new Intl.NumberFormat(undefined,{maximumFractionDigits:0}).format(x) }

    function setMode(m){
      const r = document.getElementById('panel-regular');
      const c = document.getElementById('panel-custom');
      const br = document.getElementById('mode-regular');
      const bc = document.getElementById('mode-custom');
      if(m==='regular'){ r.style.display='block'; c.style.display='none'; br.classList.add('active'); bc.classList.remove('active'); }
      else{ r.style.display='none'; c.style.display='block'; bc.classList.add('active'); br.classList.remove('active'); }
    }

    function computeRegular(){
      const d = +document.getElementById('r-cable-od').value;
      const L = +document.getElementById('r-length').value;
      const out = document.getElementById('r-out');
      if(d<=0||L<=0){out.innerHTML = `<div>Please enter Cable OD and Length.</div>`;return}
      let best = null;
      for(const r of reels){ const capF = cap90_factory(r.od,r.id,r.traverse,d); if(capF>=L){best = {...r, capF, capG:cap90_geometric(r.od,r.id,r.traverse,d)}; break} }
      if(!best){
        const last=reels[reels.length-1];
        const capF=cap90_factory(last.od,last.id,last.traverse,d);
        out.innerHTML = `<div class="pill">Exceeds largest reel. Max standard: <b>${last.reel} × ${last.id} × ${last.traverse}</b> → <b class="mono">${fmtMeters(capF)} m</b> (factory)</div>`;
        return
      }
      const usage = L/best.capF*100;
      out.innerHTML = `
        <div class="caps">
          <div class="pill">Reel: <b>${best.reel} × ${best.id} × ${best.traverse}</b> mm</div>
          <div class="pill">Cap @90% (factory): <b class="mono">${fmtMeters(best.capF)} m</b></div>
        </div>
        <div class="caps" style="margin-top:6px">
          <div class="pill">Length: <b class="mono">${fmtMeters(L)} m</b></div>
          <div class="pill">Usage: <b class="mono">${usage.toFixed(1)}%</b></div>
        </div>
        <div class="note">Geometric @90% (no calibration): ${fmtMeters(best.capG)} m</div>`;
    }

    function computeCustom(){
      const d = +document.getElementById('c-cable-od').value;
      const rod = +document.getElementById('c-rod').value;
      const rid = +document.getElementById('c-rid').value;
      const trv = +document.getElementById('c-trv').value;
      const out = document.getElementById('c-out');
      if(d<=0||rod<=0||rid<=0||trv<=0){out.innerHTML = `<div>Please enter all reel and cable values.</div>`;return}
      if(rid>=rod){out.innerHTML = `<div>Barrel ID must be smaller than Reel OD.</div>`;return}
      const capG100 = (trv * ((rod*rod - rid*rid)/(d*d)))/1000; // 100% geometric
      const cap90G  = cap90_geometric(rod,rid,trv,d);
      const cap90F  = cap90_factory(rod,rid,trv,d);
      out.innerHTML = `
        <div class="caps">
          <div class="pill">Cap @90% (factory): <b class="mono">${fmtMeters(cap90F)} m</b></div>
          <div class="pill">@100% (geometric): <b class="mono">${fmtMeters(capG100)}</b> m</div>
        </div>
        <div class="note">Geometric @90% (no calibration): ${fmtMeters(cap90G)} m</div>
        <table class="tbl mono" style="margin-top:8px">
          <tr><th>Cable OD</th><th>Reel OD</th><th>Barrel ID</th><th>Traverse</th></tr>
          <tr><td>${d} mm</td><td>${rod} mm</td><td>${rid} mm</td><td>${trv} mm</td></tr>
        </table>`;
    }

    function buildReelTable(){
      const d = +document.getElementById('t-od').value;
      const L = +document.getElementById('t-len').value;
      const t = document.getElementById('reel-table');
      if(!(d>0)){ t.innerHTML = '<tr><td>Please enter Cable OD.</td></tr>'; return }
      const header = `<tr><th>Reel</th><th>OD</th><th>ID (Barrel)</th><th>Traverse</th><th>Cap @90% (factory, m)</th>${L>0?'<th>Fits '+fmtMeters(L)+' m?</th>':''}</tr>`;
      const rows = reels.map(r=>{
        const capF = cap90_factory(r.od,r.id,r.traverse,d);
        const fits = L>0 ? (capF>=L? 'Yes' : 'No') : '';
        const mark = L>0 && capF>=L ? ' style="font-weight:700"' : '';
        return `<tr${mark}><td>${r.reel}</td><td>${r.od}</td><td>${r.id}</td><td>${r.traverse}</td><td>${fmtMeters(capF)}</td>${L>0?`<td>${fits}</td>`:''}</tr>`
      });
      t.innerHTML = [header, ...rows].join('');
    }

    function resetRegular(){ document.getElementById('r-cable-od').value=''; document.getElementById('r-length').value=''; document.getElementById('r-out').innerHTML='' }
    function resetCustom(){ document.getElementById('c-cable-od').value=''; document.getElementById('c-rod').value=''; document.getElementById('c-rid').value=''; document.getElementById('c-trv').value=''; document.getElementById('c-out').innerHTML='' }

    async function copyText(txt){ try{ await navigator.clipboard.writeText(txt); return true } catch(e){ const ta=document.createElement('textarea'); ta.value=txt; document.body.appendChild(ta); ta.select(); const ok=document.execCommand('copy'); document.body.removeChild(ta); return ok } }
    async function copyRegular(){ const box=document.getElementById('r-out'); const btn=document.getElementById('r-copy'); const txt=box.innerText.trim(); if(!txt){btn.textContent='Copy';return} const ok=await copyText(txt); btn.textContent= ok? 'Copied!' : 'Copy'; setTimeout(()=>btn.textContent='Copy',1200) }
    async function copyCustom(){ const box=document.getElementById('c-out'); const btn=document.getElementById('c-copy'); const txt=box.innerText.trim(); if(!txt){btn.textContent='Copy';return} const ok=await copyText(txt); btn.textContent= ok? 'Copied!' : 'Copy'; setTimeout(()=>btn.textContent='Copy',1200) }

    // Self-tests (console)
    (function(){
      try {
        const approx = (a,b,eps=1)=> Math.abs(a-b) <= eps;
        const g90 = cap90_geometric(1600,800,800,31);
        console.assert(approx(Math.round(g90), 1439, 2), 'Test1: geometric 90% ≈ 1439 m, got', g90);
        const f90 = cap90_factory(1600,800,800,31);
        console.assert(approx(Math.round(f90), 1130, 3), 'Test2: factory 90% ≈ 1130 m, got', f90);
        console.assert(typeof buildReelTable === 'function', 'Test3: buildReelTable missing');
        console.log('%cReel tests passed','color:green');
      } catch(e){ console.error('Reel self-tests error', e); }
    })();
  </script>

  <script>
    /* ===== Copper Rod Conversion (scoped .cu) ===== */
    (function(){
      var FT_TO_M = 0.3048;
      var DENS_KG_PER_M_PER_MM2 = 0.00896; // copper density conversion

      function el(id){ return document.getElementById(id); }
      var tStrip = el('cu-tStrip');
      var tRod   = el('cu-tRod');
      var tRM    = el('cu-tRM');
      var mode   = el('cu-mode');

      var width  = el('cu-width');
      var thk    = el('cu-thickness');
      var dia    = el('cu-diameter');
      var areaRM = el('cu-areaRM');

      var given  = el('cu-given');
      var givenLabel = el('cu-given-label');

      var areaEl = el('cu-area');
      var kgpmEl = el('cu-kgpm');
      var resHead= el('cu-result-head');
      var resSub = el('cu-result-sub');

      var btnReset = el('cu-reset');
      var btnCopy  = el('cu-copy');
      var btnSwap  = el('cu-quickSwap');

      function setType(type){
        var isStrip = type === 'Strip';
        var isRod   = type === 'Rod';
        var isRM    = type === 'RM';

        tStrip.classList.toggle('active', isStrip); tStrip.setAttribute('aria-selected', isStrip);
        tRod.classList.toggle('active', isRod);     tRod.setAttribute('aria-selected', isRod);
        tRM.classList.toggle('active', isRM);       tRM.setAttribute('aria-selected', isRM);

        document.querySelectorAll('.cu .only-strip').forEach(function(n){ n.style.display = isStrip ? 'block' : 'none'; });
        document.querySelectorAll('.cu .only-rod').forEach(function(n){   n.style.display = isRod   ? 'block' : 'none'; });
        document.querySelectorAll('.cu .only-rm').forEach(function(n){    n.style.display = isRM    ? 'block' : 'none'; });

        compute();
      }
      function currentType(){
        if(tStrip.classList.contains('active')) return 'Strip';
        if(tRod.classList.contains('active')) return 'Rod';
        if(tRM.classList.contains('active')) return 'RM';
        return 'Strip';
      }
      function updateGivenUI(){
        var m = mode.value, label = 'Given', ph='';
        if(m === 'Meter to Kg'){ label = 'Given Meter'; ph='e.g., 100'; }
        else if(m === 'Ft to Kg'){ label = 'Given Ft'; ph='e.g., 500'; }
        else { label = 'Given Kg'; ph='e.g., 500'; }
        givenLabel.textContent = label; given.placeholder = ph;
      }
      function num(v){ var n = Number(v); return isFinite(n) ? n : NaN; }
      function computeArea(){
        var type = currentType();
        if(type === 'Strip'){
          var w = num(width.value), t = num(thk.value);
          if(!(w>0) || !(t>0)) return 0; return w*t;
        } else if(type === 'Rod'){
          var d = num(dia.value);
          if(!(d>0)) return 0; return Math.PI * d * d / 4;
        } else {
          var a = num(areaRM.value); return a>0 ? a : 0;
        }
      }
      function compute(){
        var a = computeArea();
        if(areaEl) areaEl.textContent = a ? a.toFixed(2) : '—';
        if(a <= 0){
          if(kgpmEl) kgpmEl.textContent = '—';
          resHead.textContent = 'Result: —';
          resSub.textContent = 'Cross-section area is zero — enter required dimensions.';
          return;
        }
        var kgpm = DENS_KG_PER_M_PER_MM2 * a;
        if(kgpmEl) kgpmEl.textContent = kgpm.toFixed(4);

        var g = num(given.value);
        if(!(g>=0)){ resHead.textContent='Result: —'; resSub.textContent='Enter a non-negative value.'; return; }

        var m = mode.value, out = NaN, unit = '';
        if(m === 'Meter to Kg'){ out = g * kgpm; unit='kg'; }
        else if(m === 'Ft to Kg'){ out = g * FT_TO_M * kgpm; unit='kg'; }
        else if(m === 'Kg to Meter'){ out = g / kgpm; unit='m'; }
        else if(m === 'Kg to Ft'){ out = g / (FT_TO_M * kgpm); unit='ft'; }

        if(!isFinite(out)){ resHead.textContent='Result: —'; resSub.textContent='Cannot compute result — check inputs.'; return; }

        var main = Number(out.toFixed(2)).toLocaleString();
        resHead.textContent = 'Result: ' + main + ' ' + unit;

        var type = currentType();
        var dims = (type === 'Strip')
          ? ('W = ' + Number(width.value||0) + ' mm · T = ' + Number(thk.value||0) + ' mm')
          : (type === 'Rod' ? ('D = ' + Number(dia.value||0) + ' mm') : ('Area = ' + Number(areaRM.value||0) + ' mm²'));
        resSub.textContent = (document.getElementById('cu-given-label').textContent) + ': ' + Number(g) + ' · ' + dims;
      }
      function resetAll(){
        setType('Strip'); mode.value='Kg to Meter';
        width.value=''; thk.value=''; dia.value=''; areaRM.value=''; given.value='';
        updateGivenUI(); compute();
      }
      function swap(){
        var m = mode.value;
        if(m === 'Kg to Meter'){ mode.value = 'Meter to Kg'; }
        else if(m === 'Meter to Kg'){ mode.value = 'Kg to Meter'; }
        else if(m === 'Kg to Ft'){ mode.value = 'Ft to Kg'; }
        else if(m === 'Ft to Kg'){ mode.value = 'Kg to Ft'; }
        updateGivenUI(); compute();
      }

      // Events
      tStrip.addEventListener('click', function(){ setType('Strip'); });
      tRod.addEventListener('click',   function(){ setType('Rod');   });
      tRM.addEventListener('click',    function(){ setType('RM');    });
      mode.addEventListener('change',  function(){ updateGivenUI(); compute(); });
      [width, thk, dia, areaRM, given].forEach(function(elm){ elm.addEventListener('input', compute); });
      document.getElementById('cu-reset').addEventListener('click', resetAll);
      document.getElementById('cu-copy').addEventListener('click', function(){
        var txt = (document.getElementById('cu-result-head').textContent||'') + ' | ' + (document.getElementById('cu-result-sub').textContent||'');
        if(navigator.clipboard && navigator.clipboard.writeText){ navigator.clipboard.writeText(txt); }
      });
      document.getElementById('cu-quickSwap').addEventListener('click', swap);

      // Init
      setType('Strip'); updateGivenUI(); compute();
    })();
  </script>
</body>
</html>
